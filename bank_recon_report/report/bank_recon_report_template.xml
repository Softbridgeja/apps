<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_bank_recon_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="record">
                <div class="page">
                    <h2 class="text-center">Bank Reconciliation Report</h2>
                    <div class="row mt-4">
                        <div class="col-6">
                            <strong>Journal:</strong> <span t-esc="record.report_data['journal']"/><br/>
                            <strong>Period:</strong>
                            <span t-esc="record.report_data['date_from']"/> -
                            <span t-esc="record.report_data['date_to']"/>
                        </div>
                    </div>

                    <!-- 1. SUMMARY TABLE -->
                    <table class="table table-sm mt-4">
                        <tbody>
                            <tr>
                                <td><strong>Opening GL balance</strong></td>
                                <td class="text-end">
                                    <span t-esc="record.report_data['opening']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Add: Debits per GL</td>
                                <td class="text-end">
                                    <span t-esc="record.report_data['debit']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Less: Credits per GL</td>
                                <td class="text-end">
                                    <span t-esc="record.report_data['credit']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Unpresented checks</td>
                                <td class="text-end">
                                    <span t-esc="record.report_data['unp_chks']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Unpresented lodgements</td>
                                <td class="text-end">
                                    <span t-esc="record.report_data['unp_lodgs']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/>
                                </td>
                            </tr>
                            <tr class="table-secondary">
                                <td><strong>Closing GL balance</strong></td>
                                <td class="text-end">
                                    <strong><span t-esc="record.report_data['closing']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/></strong>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Bank statement balance</strong></td>
                                <td class="text-end">
                                    <strong><span t-esc="record.report_data['bank_bal']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/></strong>
                                </td>
                            </tr>
                            <tr class="table-danger">
                                <td><strong>Variance (Book – Bank)</strong></td>
                                <td class="text-end">
                                    <strong><span t-esc="record.report_data['variance']"
                                          t-options="{'widget': 'monetary',
                                                     'display_currency': record.company_currency_id}"/></strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 2. UNRECONCILED ITEMS (optional detail) -->
                    <t t-if="record.report_data['show_details']">
                        <h4 class="mt-5">Unreconciled items</h4>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Ref</th>
                                    <th>Partner</th>
                                    <th class="text-end">Debit</th>
                                    <th class="text-end">Credit</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="lines" t-value="record._get_unreconciled_lines()"/>
                                <t t-foreach="lines" t-as="line">
                                    <tr>
                                        <td><span t-esc="line['date']"/></td>
                                        <td><span t-esc="line['ref']"/></td>
                                        <td><span t-esc="line['partner'] or ''"/></td>
                                        <td class="text-end">
                                            <span t-esc="line['debit']"
                                                  t-options="{'widget': 'monetary',
                                                             'display_currency': record.company_currency_id}"/>
                                        </td>
                                        <td class="text-end">
                                            <span t-esc="line['credit']"
                                                  t-options="{'widget': 'monetary',
                                                             'display_currency': record.company_currency_id}"/>
                                        </td>
                                        <td class="text-end">
                                            <span t-esc="line['amount']"
                                                  t-options="{'widget': 'monetary',
                                                             'display_currency': record.company_currency_id}"/>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="not lines">
                                    <tr><td colspan="6" class="text-muted text-center">No unreconciled items</td></tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                    <t t-else="">
                        <p class="text-muted mt-4">Detail lines hidden – tick “Show detail lines” to display.</p>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <!-- PDF report action -->
    <record id="action_bank_recon_report" model="ir.actions.report">
        <field name="name">Bank Reconciliation Report</field>
        <field name="model">bank.recon_wizard</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">bank_recon_report.report_bank_recon_document</field>
        <field name="binding_model_id" ref="model_bank_recon_wizard"/>
        <field name="binding_type">report</field>
    </record>
</odoo>